#include "libfm/tables.hpp"

namespace fm {

static const uint16_t logsin_tbl[128] = {
    406, 342, 304, 278, 257, 240, 226, 214, 203, 193, 185, 177, 169, 163, 156,
    150, 145, 140, 135, 130, 126, 122, 118, 114, 110, 107, 103, 100, 97,  94,
    91,  88,  86,  83,  80,  78,  76,  73,  71,  69,  67,  65,  63,  61,  59,
    57,  55,  54,  52,  50,  49,  47,  46,  44,  43,  42,  40,  39,  38,  36,
    35,  34,  33,  32,  30,  29,  28,  27,  26,  25,  24,  23,  22,  21,  21,
    20,  19,  18,  17,  17,  16,  15,  14,  14,  13,  12,  12,  11,  11,  10,
    9,   9,   8,   8,   7,   7,   6,   6,   5,   5,   5,   4,   4,   4,   3,
    3,   3,   2,   2,   2,   2,   1,   1,   1,   1,   1,   0,   0,   0,   0,
    0,   0,   0,   0,   0,   0,   0,   0};

static const uint16_t mantissa_tbl[64] = {
    2047, 2024, 2003, 1981, 1960, 1939, 1918, 1897, 1877, 1856, 1836,
    1817, 1797, 1778, 1759, 1740, 1721, 1702, 1684, 1666, 1648, 1630,
    1613, 1595, 1578, 1561, 1544, 1527, 1511, 1495, 1479, 1463, 1447,
    1431, 1416, 1401, 1386, 1371, 1356, 1341, 1327, 1313, 1298, 1284,
    1271, 1257, 1243, 1230, 1217, 1204, 1191, 1178, 1165, 1152, 1140,
    1128, 1116, 1104, 1092, 1080, 1068, 1057, 1045, 1034};

int logsin9(int x, int* sign) {
  x ^= (x & 128) ? 0x7f : 0;
  *sign *= (x & 256) ? -1 : 1;
  return logsin_tbl[x & 0x7f];
}

int iexp11(int x) {
  if (x < 0) {
    return 0;
  }
  if (x > 511) {
    return 0;
  }
  return mantissa_tbl[x & 63] >> (x >> 6);
}

}  // namespace fm 